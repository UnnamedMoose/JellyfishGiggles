using Plots
using Images
using LinearAlgebra
using StaticArrays
using Interpolations
using ColorSchemes
using Optim
using StaticArrays
using CUDA

struct KinematicsArray{T, N, M}
    Nsegments::Int
    cps_thetas::StaticArrays.SArray{Tuple{N, M}, T}
    cps_lengths::StaticArrays.SArray{Tuple{N, M}, T}
    cps_halfThicknesses::StaticArrays.SArray{Tuple{N, 8}, T}
end


kinematics_0_baseline = KinematicsArray{Float64, 6+1, 7}(
    # No. segments
    6,
    # Segment angles.
    SMatrix{6+1, 7}(vcat([
    # t/T values
    [0, 0.025, 0.15, 0.25, 0.35, 0.45, 1.0]',
    # CP locations
    hcat([
        [0., 0.,        0., 0., 0.,       0., 0.],
        [0., 0.,        0., 0., 0.,       0., 0.],
        [0.39, 0.39,        0., 0.38, 0.39,       0.39, 0.39],
        [0.4, 0.4,        0.85, 1.2, 0.41,       0.4, 0.4],
        [0.95, 0.95,        1.95, 1.65, 0.95,       0.95, 0.95],
        [2.2, 2.2,        -1., 2.19, 2.2,       2.2, 2.2],
    ]...)'
    ]...)),
    # Segment lengths
    SMatrix{6+1, 7}(vcat([
    [0, 0.025, 0.15, 0.25, 0.35, 0.45, 1.0]',
    hcat([
        [0.02, 0.02,        0.01, 0.03, 0.022,       0.02, 0.02],
        [0.04, 0.04,        0.02, 0.06, 0.04,       0.04, 0.04],
        [0.12, 0.12,        0.1, 0.155, 0.11,       0.12, 0.12],
        [0.194, 0.194,        0.275, 0.194, 0.194,       0.194, 0.194],
        [0.228, 0.228,        0.16, 0.225, 0.228,       0.228, 0.228],
        [0.250, 0.250,        0.135, 0.245, 0.250,       0.250, 0.250],
    ]...)'
    ]...)),
    # Segment half-thicknesses
    SMatrix{6+1, 8}(vcat([
    [0, 0.025, 0.06, 0.16, 0.25, 0.34, 0.45, 1.0]',
    hcat([
        [ 0.097000, 0.097000, 0.082523, 0.117000, 0.076917, 0.097000, 0.097000, 0.097000 ],
        [ 0.097000, 0.097000, 0.085018, 0.113000, 0.079934, 0.097000, 0.097000, 0.097000 ],
        [ 0.083000, 0.083000, 0.073513, 0.101000, 0.068950, 0.083000, 0.083000, 0.083000 ],
        [ 0.063000, 0.063000, 0.058009, 0.075000, 0.051967, 0.063000, 0.063000, 0.063000 ],
        [ 0.033500, 0.033500, 0.032505, 0.039000, 0.028984, 0.033500, 0.033500, 0.033500 ],
        [ 0.011000, 0.011000, 0.011000, 0.011000, 0.011000, 0.011000, 0.011000, 0.011000 ],
    ]...)'
    ]...))
)

kinematics_1_noFlick = KinematicsArray{Float64, 6+1, 7}(
    # No. segments
    6,
    # Segment angles.
    SMatrix{6+1, 7}(vcat([
    # t/T values
    [0, 0.025, 0.15, 0.25, 0.35, 0.45, 1.0]',
    # CP locations
    hcat([
        [0., 0.,        0., 0., 0.,       0., 0.],
        [0., 0.,        0., 0., 0.,       0., 0.],
        [0.39, 0.39,        0., 0.38, 0.39,       0.39, 0.39],
        [0.4, 0.4,        0.85, 1.2, 0.41,       0.4, 0.4],
        [0.95, 0.95,        1.95, 1.65, 0.95,       0.95, 0.95],
        [2.2, 2.2,        2., 2., 2.,       2.2, 2.2],
    ]...)'
    ]...)),
    # Segment lengths
    SMatrix{6+1, 7}(vcat([
    [0, 0.025, 0.15, 0.25, 0.35, 0.45, 1.0]',
    hcat([
        [0.02, 0.02,        0.01, 0.03, 0.022,       0.02, 0.02],
        [0.04, 0.04,        0.02, 0.06, 0.04,       0.04, 0.04],
        [0.12, 0.12,        0.1, 0.155, 0.11,       0.12, 0.12],
        [0.194, 0.194,        0.275, 0.194, 0.194,       0.194, 0.194],
        [0.228, 0.228,        0.16, 0.225, 0.228,       0.228, 0.228],
        [0.250, 0.250,        0.135, 0.245, 0.250,       0.250, 0.250],
    ]...)'
    ]...)),
    # Segment half-thicknesses
    SMatrix{6+1, 8}(vcat([
    [0, 0.025, 0.06, 0.16, 0.25, 0.34, 0.45, 1.0]',
    hcat([
        [ 0.097000, 0.097000, 0.092676, 0.105580, 0.079560, 0.097000, 0.097000, 0.097000 ],
        [ 0.097000, 0.097000, 0.093141, 0.103864, 0.082047, 0.097000, 0.097000, 0.097000 ],
        [ 0.083000, 0.083000, 0.079606, 0.094149, 0.070536, 0.083000, 0.083000, 0.083000 ],
        [ 0.063000, 0.063000, 0.062070, 0.070432, 0.053024, 0.063000, 0.063000, 0.063000 ],
        [ 0.033500, 0.033500, 0.034536, 0.036716, 0.029512, 0.033500, 0.033500, 0.033500 ],
        [ 0.011000, 0.011000, 0.011000, 0.011000, 0.011000, 0.011000, 0.011000, 0.011000 ],
    ]...)'
    ]...))
)

kinematics_2_largeFlick = KinematicsArray{Float64, 6+1, 7}(
    # No. segments
    6,
    # Segment angles.
    SMatrix{6+1, 7}(vcat([
    # t/T values
    [0, 0.025, 0.15, 0.25, 0.35, 0.45, 1.0]',
    # CP locations
    hcat([
        [0., 0.,        0., 0., 0.,       0., 0.],
        [0., 0.,        0., 0., 0.,       0., 0.],
        [0.39, 0.39,        0., 0.38, 0.39,       0.39, 0.39],
        [0.4, 0.4,        0.85, 1.2, 0.41,       0.4, 0.4],
        [0.95, 0.95,        1.95, 1.65, 0.95,       0.95, 0.95],
        [2.2, 2.2,        -2.5, 2.19, 2.2,       2.2, 2.2],
    ]...)'
    ]...)),
    # Segment lengths
    SMatrix{6+1, 7}(vcat([
    [0, 0.025, 0.15, 0.25, 0.35, 0.45, 1.0]',
    hcat([
        [0.02, 0.02,        0.01, 0.03, 0.022,       0.02, 0.02],
        [0.04, 0.04,        0.02, 0.06, 0.04,       0.04, 0.04],
        [0.12, 0.12,        0.1, 0.155, 0.11,       0.12, 0.12],
        [0.194, 0.194,        0.275, 0.194, 0.194,       0.194, 0.194],
        [0.228, 0.228,        0.2, 0.225, 0.228,       0.228, 0.228],
        [0.250, 0.250,        0.18, 0.275, 0.2650,       0.250, 0.250],
    ]...)'
    ]...)),
    # Segment half-thicknesses
    SMatrix{6+1, 8}(vcat([
    [0, 0.025, 0.06, 0.16, 0.25, 0.34, 0.45, 1.0]',
    hcat([
        [ 0.097000, 0.097000, 0.087949, 0.108857, 0.083904, 0.097000, 0.097000, 0.097000 ],
        [ 0.097000, 0.097000, 0.089359, 0.106486, 0.083723, 0.097000, 0.097000, 0.097000 ],
        [ 0.083000, 0.083000, 0.067192, 0.115701, 0.062542, 0.083000, 0.083000, 0.083000 ],
        [ 0.063000, 0.063000, 0.053795, 0.083801, 0.045361, 0.063000, 0.063000, 0.063000 ],
        [ 0.033500, 0.033500, 0.031397, 0.040900, 0.030196, 0.033500, 0.033500, 0.033500 ],
        [ 0.011000, 0.011000, 0.011000, 0.012000, 0.011000, 0.011000, 0.011000, 0.011000 ],
    ]...)'
    ]...))
)
